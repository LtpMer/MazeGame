<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Maze Game - Full Working Example</title>
<style>
  body {
    margin: 0; padding: 0; font-family: Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center;
  }
  #gameCanvas {
    border: 1px solid black;
    touch-action: none; /* for mobile touch support */
    margin-top: 20px;
    background: #eee;
  }
  #controls {
    margin-top: 10px;
  }
  button {
    margin-right: 5px;
    font-size: 16px;
    padding: 6px 10px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h2>Maze Game</h2>
<div id="controls">
  <button id="toggleBuildBtn">Toggle Build Mode (OFF)</button>
  <button id="drawWallBtn" disabled>Draw Wall</button>
  <button id="deleteWallBtn" disabled>Delete Wall</button>
</div>
<canvas id="gameCanvas" width="600" height="600"></canvas>

<script>
(() => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const cols = 25;
  const rows = 25;
  const cellSize = canvas.width / cols;

  let maze = [];
  let player = { x: 0, y: 0 };
  let win = { x: 0, y: 0 };
  let keys = {};
  let buildMode = false;
  let drawMode = "draw"; // "draw" or "delete"

  const toggleBuildBtn = document.getElementById("toggleBuildBtn");
  const drawWallBtn = document.getElementById("drawWallBtn");
  const deleteWallBtn = document.getElementById("deleteWallBtn");

  // Initialize maze: 0=empty, 1=wall
  function generateMaze() {
    maze = [];
    for (let x = 0; x < cols; x++) {
      maze[x] = [];
      for (let y = 0; y < rows; y++) {
        maze[x][y] = Math.random() < 0.3 ? 1 : 0;
      }
    }
    // Make sure borders are walls
    for (let i = 0; i < cols; i++) {
      maze[i][0] = 1;
      maze[i][rows - 1] = 1;
    }
    for (let j = 0; j < rows; j++) {
      maze[0][j] = 1;
      maze[cols - 1][j] = 1;
    }

    // Place player and win randomly on empty cells
    player = getRandomEmptyCell();
    win = getRandomEmptyCell();
    // Make sure player and win don't overlap
    while (win.x === player.x && win.y === player.y) {
      win = getRandomEmptyCell();
    }
  }

  function getRandomEmptyCell() {
    let x, y;
    do {
      x = Math.floor(Math.random() * cols);
      y = Math.floor(Math.random() * rows);
    } while (maze[x][y] !== 0);
    return { x, y };
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let x = 0; x < cols; x++) {
      for (let y = 0; y < rows; y++) {
        if (maze[x][y] === 1) {
          ctx.fillStyle = "black"; // Wall
        } else {
          ctx.fillStyle = "white"; // Empty space
        }
        ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        ctx.strokeStyle = "#ccc";
        ctx.strokeRect(x * cellSize, y * cellSize, cellSize, cellSize);
      }
    }
    // Draw win spot (green)
    ctx.fillStyle = "green";
    ctx.fillRect(win.x * cellSize, win.y * cellSize, cellSize, cellSize);
    // Draw player (red)
    ctx.fillStyle = "red";
    ctx.fillRect(player.x * cellSize, player.y * cellSize, cellSize, cellSize);
  }

  // Movement
  function movePlayer() {
    if (buildMode) return; // No movement in build mode

    let dx = 0, dy = 0;
    if (keys["ArrowUp"] || keys["w"]) dy = -1;
    else if (keys["ArrowDown"] || keys["s"]) dy = 1;
    else if (keys["ArrowLeft"] || keys["a"]) dx = -1;
    else if (keys["ArrowRight"] || keys["d"]) dx = 1;

    let newX = player.x + dx;
    let newY = player.y + dy;

    if (
      newX >= 0 && newX < cols &&
      newY >= 0 && newY < rows &&
      maze[newX][newY] === 0
    ) {
      player.x = newX;
      player.y = newY;
    }

    if (player.x === win.x && player.y === win.y) {
      alert("You Win!");
      generateMaze();
    }
  }

  // Mouse / Touch position to cell coords
  function getMouseCell(evt) {
    const rect = canvas.getBoundingClientRect();
    const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
    const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
    const x = Math.floor((clientX - rect.left) / cellSize);
    const y = Math.floor((clientY - rect.top) / cellSize);
    return { x, y };
  }

  // Draw/delete walls by mouse or touch
  function handleDraw(evt) {
    if (!buildMode) return;
    evt.preventDefault();

    const { x, y } = getMouseCell(evt);
    if (x < 0 || x >= cols || y < 0 || y >= rows) return;
    // Can't change player or win cell
    if ((x === player.x && y === player.y) || (x === win.x && y === win.y)) return;

    if (drawMode === "draw") {
      maze[x][y] = 1;
    } else if (drawMode === "delete") {
      maze[x][y] = 0;
    }
  }

  // Event listeners
  document.addEventListener("keydown", (e) => {
    keys[e.key] = true;
  });
  document.addEventListener("keyup", (e) => {
    keys[e.key] = false;
  });

  canvas.addEventListener("mousedown", (e) => {
    handleDraw(e);
    canvas.addEventListener("mousemove", handleDraw);
  });
  canvas.addEventListener("mouseup", () => {
    canvas.removeEventListener("mousemove", handleDraw);
  });

  // Touch events for mobile
  canvas.addEventListener("touchstart", handleDraw);
  canvas.addEventListener("touchmove", handleDraw);

  // Buttons handlers
  toggleBuildBtn.addEventListener("click", () => {
    buildMode = !buildMode;
    toggleBuildBtn.textContent = "Toggle Build Mode (" + (buildMode ? "ON" : "OFF") + ")";
    drawWallBtn.disabled = !buildMode;
    deleteWallBtn.disabled = !buildMode;
  });

  drawWallBtn.addEventListener("click", () => {
    drawMode = "draw";
    drawWallBtn.style.backgroundColor = "lightgreen";
    deleteWallBtn.style.backgroundColor = "";
  });
  deleteWallBtn.addEventListener("click", () => {
    drawMode = "delete";
    deleteWallBtn.style.backgroundColor = "lightcoral";
    drawWallBtn.style.backgroundColor = "";
  });

  // Init
  generateMaze();
  drawWallBtn.style.backgroundColor = "lightgreen";

  // Game loop
  function loop() {
    movePlayer();
    draw();
    requestAnimationFrame(loop);
  }
  loop();

})();
</script>

</body>
</html>
